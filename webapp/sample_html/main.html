<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../style/css/main.css">
</head>
<body>
    
    <form action="" id="mainform">
        <div id="wrap">
            <header>
                <div style="float : left; width : 250px;">Logo</div>
                <div id="topmenu">
                    <ul>
                        <a href="#" onclick=""><li class="home"></li></a>
                        <a href="#" onclick=""><li class="login"></li></a>
                        <a href="#" onclick=""><li class="join"></li></a>
                        <a href="#" onclick=""><li class="info"></li></a>
                    </ul>
                    <div>
                        <input type="text" id="search_text" placeholder="통합검색"/><button id="search_top" >검색</button>
                        HOT 검색어
                    </div>
                </div>
            </header>
    
            <div id="mainbody">
                <div id="left">
                    <nav>
                        <ul>
                            <li class="accordion">
                                <p>정보공개</p>
                                <ul class="item hidden">
                                    <li>공지사항</li>
                                </ul>
                            </li>
                            <li class="accordion">
                                <p>기차표예매</p>
                                <ul class="item hidden">
                                    <li>철도예매</li>
                                    <li>관광열차예매</li>
                                </ul>
                            </li>
                            <li class="accordion">
                                <p>고객지원</p>
                                <ul class="item hidden">
                                    <li>불만사항</li>
                                    <li>자유게시판</li>
                                    <li>요청사항</li>
                                    <li>칭찬합시다</li>
                                </ul>
                            </li>
                            <li class="accordion">
                                <p>소개</p>
                                <ul class="item hidden">
                                    <li>사업분야</li>
                                    <li>찾아오시는 길</li>
                                </ul>
                            </li>
                        </ul>
                    </nav>
                </div>
    
                <div id="content">
                    
                </div>
            </div>
        </div>
    </form>
    
    <script>
        // jQuery의 one을 자바스크립트로 구현
        function submit(event) {
            var e = event || window.event;
            let searchForm = document.getElementById("mainform");
            let search_text = document.getElementById("search_text").value;

            if( search_text === '' ) {
                alert("검색어를 입력하세요");
            } else {
                if(e.currentTarget.dataset.triggered) return;
                e.currentTarget.dataset.triggered = true;
                searchForm.submit();
            }
        }

        // Event Listener - IIFE 사용하여 등록
        (function() {
            
            let search_top_submit = document.getElementById("search_top");
            if(search_top_submit.addEventListener) {
                search_top_submit.addEventListener('click', submit, false);
            } else {
                search_top_submit.attachEvent('onclick', submit);
            }
        }());
        
        function hasClass(element, cls) {
            return (' ' + element.className + ' ').indexOf(' ' + cls + ' ') > -1;
        }

        (function() {
            
            let accordion = document.getElementsByClassName("accordion");

            for( var i = 0; i < accordion.length; i++ ) {
                // 클로저
                (
                    function(j) {
                        var accordion_obj = accordion[j];

                        if(accordion_obj.addEventListener) {
                            accordion_obj.addEventListener('click'
                            , function() {
                                this.classList.toggle("active");

                                if( this.classList.contains("active") ) {
                                    var toggleList = document.getElementsByClassName("active");
                                    if(toggleList.length > 0) {
                                        for( var inner = 0; inner < toggleList.length; inner++ ) {
                                            if(toggleList[inner] != this) {
                                                toggleList[inner].classList.remove("active")
                                            }
                                        }   
                                    }
                                    
                                } 
                            }
                            , false);
                        } else {

                        }
                    }
                )(i);
            }

            /*
            for( var i = 0; i < accordion.length; i++ ) {
                // 클로저
                (
                    function(j) {
                        var accordion_obj = accordion[j];
                        
                        if(accordion_obj.addEventListener) {
                            accordion_obj.addEventListener('click'
                            , function() {
                                var c = accordion_obj.getElementsByClassName("item");
                                var annoth = document.getElementsByClassName("active");
                                
                                if( annoth.length > 0 ) {
                                    for( var annoI = 0; annoI < annoth.length; annoI++ ) {
                                        annoth[annoI].classList.remove("active");
                                    }
                                }
                                
                                var child = document.getElementsByTagName("p");

                                // 활성화 되어 있는 Nav 모두 해제(어차피 하나임)
                                if( c[0].className.indexOf("hidden") > 0 ) {
                                    this.classList.toggle("active");
                                    // 활성화 되어 있는 Nav 모두 해제
                                    c[0].className = "item show";
                                } else {
                                    this.classList.remove("active");
                                    c[0].className = "item hidden";
                                }
                            }
                            , false); 
                        } else {
                            accordion[i].attachEvent('onclick', function() {
                                alert("attachClick");
                            });
                        }
                    
                    }
                )(i);
            }
            */
        }());

    </script>
</body>
</html>